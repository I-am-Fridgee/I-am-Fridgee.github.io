<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Bloxdschem Viewer</title>
  <style>
    body { font-family: monospace; background: #111; color: #0f0; padding: 20px; }
    #dropzone { border: 2px dashed #0f0; padding: 40px; text-align: center; cursor: pointer; }
    pre { white-space: pre-wrap; word-wrap: break-word; }
  </style>
</head>
<body>
  <h1>Bloxdschem Viewer</h1>
  <div id="dropzone">Drop your .bloxdschem file here</div>
  <pre id="output"></pre>

  <!-- Correct NBT Parser -->
  <script src="https://unpkg.com/prismarine-nbt@2.2.1/dist/nbt-browser.min.js"></script>
  <script>
    const dropzone = document.getElementById("dropzone");
    const output = document.getElementById("output");

    // Drag & Drop handlers
    dropzone.addEventListener("dragover", e => {
      e.preventDefault();
      dropzone.style.background = "#222";
    });
    dropzone.addEventListener("dragleave", e => {
      e.preventDefault();
      dropzone.style.background = "none";
    });
    dropzone.addEventListener("drop", e => {
      e.preventDefault();
      dropzone.style.background = "none";
      const file = e.dataTransfer.files[0];
      if (file) {
        readFile(file);
      }
    });

    // File reader + NBT parser
    function readFile(file) {
      const reader = new FileReader();
      reader.readAsArrayBuffer(file);

      reader.onload = function(event) {
        try {
          const buffer = new Uint8Array(event.target.result);

          // Use the correct global object: prismarineNbt
          prismarineNbt.parse(buffer, (err, data) => {
            if (err) {
              output.textContent = "Error parsing: " + err.message;
            } else {
              output.textContent = JSON.stringify(data, null, 2);
            }
          });
        } catch (err) {
          output.textContent = "Failed: " + err.message;
        }
      };
    }
  </script>
</body>
</html>
